### ============================================================
### ClipSlot Sync Server API Tests
### Base URL: http://localhost:3000
### ============================================================

### --- Auth ---

### 1. Register a new user
POST http://localhost:3000/api/auth/register
Content-Type: application/json

{
  "email": "test@test.com",
  "password": "test1234"
}

### 2. Login
POST http://localhost:3000/api/auth/login
Content-Type: application/json

{
  "email": "test@test.com",
  "password": "test1234"
}

### 3. Register a device (use token from login/register)
POST http://localhost:3000/api/auth/device
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "MacBook Pro",
  "device_type": "macos"
}

### 4. List devices
GET http://localhost:3000/api/auth/devices
Authorization: Bearer {{device_token}}

### 5. Delete a device
DELETE http://localhost:3000/api/auth/device/{{device_id}}
Authorization: Bearer {{device_token}}

### --- Sync: Slots ---

### 6. Update slot 1 with encrypted blob
PUT http://localhost:3000/api/sync/slots/1
Content-Type: application/json
Authorization: Bearer {{device_token}}

{
  "encrypted_blob": "RU5DOlRlc3RFbmNyeXB0ZWRTbG90RGF0YUJhc2U2NA=="
}

### 7. Update slot 2
PUT http://localhost:3000/api/sync/slots/2
Content-Type: application/json
Authorization: Bearer {{device_token}}

{
  "encrypted_blob": "RU5DOlNsb3QyRW5jcnlwdGVkQ29udGVudA=="
}

### 8. Get all slots
GET http://localhost:3000/api/sync/slots
Authorization: Bearer {{device_token}}

### --- Sync: History ---

### 9. Push a history item
POST http://localhost:3000/api/sync/history
Content-Type: application/json
Authorization: Bearer {{device_token}}

{
  "id": "11111111-1111-1111-1111-111111111111",
  "encrypted_blob": "RU5DOkhpc3RvcnlJdGVtMUVuY3J5cHRlZA==",
  "content_hash": "a1b2c3d4e5f6"
}

### 10. Push another history item
POST http://localhost:3000/api/sync/history
Content-Type: application/json
Authorization: Bearer {{device_token}}

{
  "id": "22222222-2222-2222-2222-222222222222",
  "encrypted_blob": "RU5DOkhpc3RvcnlJdGVtMkVuY3J5cHRlZA==",
  "content_hash": "f6e5d4c3b2a1"
}

### 11. Push duplicate (same content_hash â€” should be deduped)
POST http://localhost:3000/api/sync/history
Content-Type: application/json
Authorization: Bearer {{device_token}}

{
  "id": "33333333-3333-3333-3333-333333333333",
  "encrypted_blob": "RU5DOkR1cGxpY2F0ZUNvbnRlbnQ=",
  "content_hash": "a1b2c3d4e5f6"
}

### 12. Get history (default: limit 50, offset 0)
GET http://localhost:3000/api/sync/history
Authorization: Bearer {{device_token}}

### 13. Get history with pagination
GET http://localhost:3000/api/sync/history?limit=1&offset=0
Authorization: Bearer {{device_token}}

### 14. Delete a history item
DELETE http://localhost:3000/api/sync/history/11111111-1111-1111-1111-111111111111
Authorization: Bearer {{device_token}}

### --- WebSocket ---

### 15. WebSocket connection (use in a WS client, not .http)
### ws://localhost:3000/api/sync/ws?token={{device_token}}
